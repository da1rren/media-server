{
	dynamic_dns {
		provider cloudflare {env.CF_API_TOKEN}
		versions ipv4

		domains {
			loveand.coffee jellyfin
		}
	}
}

jellyfin.loveand.coffee {
	tls {
		resolvers 1.1.1.1
		dns cloudflare {env.CF_API_TOKEN}
	}

	reverse_proxy :8096
}

torrent.loveand.coffee {
	@allowed client_ip private_ranges 100.64.0.0/10

	tls {
		resolvers 1.1.1.1
		dns cloudflare {env.CF_API_TOKEN}
	}

	handle @allowed {
		reverse_proxy :8080
	}

	handle {
		header Content-Type text/plain
		templates
		respond "Sorry 403, {{.RemoteIP}} isn't allowed"
	}
}

pi.loveand.coffee {
	@allowed client_ip private_ranges 100.64.0.0/10

	tls {
		resolvers 1.1.1.1
		dns cloudflare {env.CF_API_TOKEN}
	}

	handle @allowed {
		rewrite * /admin{uri}
		reverse_proxy pi.hole:80
	}

	handle {
		header Content-Type text/plain
		templates
		respond "Sorry 403, {{.RemoteIP}} isn't allowed"
	}
}
